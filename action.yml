name: 'Security Scanner Action'
description: 'GitHub Advanced Security ê¸°ëŠ¥ì„ ì˜¤í”ˆì†ŒìŠ¤ë¡œ êµ¬í˜„í•œ í†µí•© ë³´ì•ˆ ìŠ¤ìºë„ˆ'
author: 'Security Action Team'

branding:
  icon: 'shield'
  color: 'blue'

inputs:
  # ê¸°ë³¸ ìŠ¤ìºë„ˆ
  secret-scan:
    description: 'ë¹„ë°€ê°’ ë…¸ì¶œ ìŠ¤ìº” í™œì„±í™” (Gitleaks)'
    required: false
    default: 'true'
  secret-scan-history:
    description: 'Git commit historyë„ ìŠ¤ìº” (ì „ì²´ ê¸°ë¡ ê²€ì‚¬)'
    required: false
    default: 'false'
  code-scan:
    description: 'ì½”ë“œ ì·¨ì•½ì  ìŠ¤ìº” í™œì„±í™” (Semgrep)'
    required: false
    default: 'true'
  dependency-scan:
    description: 'ì˜ì¡´ì„± ì·¨ì•½ì  ìŠ¤ìº” í™œì„±í™” (Trivy)'
    required: false
    default: 'true'

  # ì¶”ê°€ ìŠ¤ìºë„ˆ
  container-scan:
    description: 'ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ìŠ¤ìº” í™œì„±í™” (Trivy)'
    required: false
    default: 'false'
  container-image:
    description: 'ìŠ¤ìº”í•  ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ (ì˜ˆ: nginx:latest)'
    required: false
  iac-scan:
    description: 'IaC ë³´ì•ˆ ìŠ¤ìº” í™œì„±í™” (Checkov)'
    required: false
    default: 'false'
  iac-frameworks:
    description: 'IaC í”„ë ˆì„ì›Œí¬ (terraform,kubernetes,dockerfile ë“±)'
    required: false

  # ë„¤ì´í‹°ë¸Œ ì˜ì¡´ì„± ìŠ¤ìº”
  native-audit:
    description: 'ì–¸ì–´ë³„ ë„¤ì´í‹°ë¸Œ ì˜ì¡´ì„± ìŠ¤ìº” í™œì„±í™” (npm audit, pip-audit, govulncheck ë“±)'
    required: false
    default: 'false'
  native-audit-tools:
    description: 'ì‚¬ìš©í•  ë„¤ì´í‹°ë¸Œ ë„êµ¬ ëª©ë¡ (auto, npm, pip, go, cargo, bundler, composer)'
    required: false
    default: 'auto'

  # SBOM ìƒì„±
  sbom-generate:
    description: 'SBOM ìƒì„± í™œì„±í™” (Syft)'
    required: false
    default: 'false'
  sbom-format:
    description: 'SBOM ì¶œë ¥ í¬ë§· (cyclonedx-json, spdx-json, syft-json)'
    required: false
    default: 'cyclonedx-json'
  sbom-output:
    description: 'SBOM ì¶œë ¥ íŒŒì¼ ê²½ë¡œ'
    required: false
    default: 'sbom.json'

  # SonarQube
  sonar-scan:
    description: 'SonarQube ì½”ë“œ í’ˆì§ˆ ìŠ¤ìº” í™œì„±í™”'
    required: false
    default: 'false'
  sonar-host-url:
    description: 'SonarQube ì„œë²„ URL'
    required: false
    default: 'http://localhost:9000'
  sonar-token:
    description: 'SonarQube ì¸ì¦ í† í°'
    required: false
  sonar-project-key:
    description: 'SonarQube í”„ë¡œì íŠ¸ í‚¤'
    required: false

  # AI ë¦¬ë·°
  ai-review:
    description: 'AI ê¸°ë°˜ ì½”ë“œ ë¦¬ë·° í™œì„±í™” (LangGraph)'
    required: false
    default: 'false'
  ai-provider:
    description: 'AI ì œê³µì (auto, openai, anthropic)'
    required: false
    default: 'auto'
  ai-model:
    description: 'AI ëª¨ë¸ëª… (ì˜ˆ: gpt-4o, claude-3-5-sonnet-20241022)'
    required: false
  openai-api-key:
    description: 'OpenAI API í‚¤ (AI ë¦¬ë·° ì‚¬ìš© ì‹œ í•„ìˆ˜)'
    required: false
  openai-base-url:
    description: 'OpenAI í˜¸í™˜ API Base URL (ì‚¬ë‚´ ê²Œì´íŠ¸ì›¨ì´/í”„ë¡ì‹œ ì‚¬ìš© ì‹œ)'
    required: false
  anthropic-api-key:
    description: 'Anthropic API í‚¤ (AI ë¦¬ë·° ì‚¬ìš© ì‹œ ëŒ€ì•ˆ)'
    required: false

  # ê³µí†µ ì„¤ì •
  check-name:
    description: 'Required Status Check ì´ë¦„ (ê¸°ë³¸: ğŸ›¡ï¸ Security Report)'
    required: false
    default: 'ğŸ›¡ï¸ Security Report'
  skip-check:
    description: 'Required Status Check ìƒì„± ê±´ë„ˆë›°ê¸° (ê°œë³„ ìŠ¤ìºë„ˆ ì²´í¬ë§Œ ìƒì„±)'
    required: false
    default: 'false'
  scanner-checks:
    description: 'ê°œë³„ ìŠ¤ìºë„ˆ Check Run ìƒì„± ì—¬ë¶€ (ê¸°ë³¸: false - í†µí•© Reportë§Œ ìƒì„±)'
    required: false
    default: 'false'
  post-summary:
    description: 'GitHub Actions Job Summary ìƒì„± ì—¬ë¶€ (ê¸°ë³¸: true)'
    required: false
    default: 'true'
  severity-threshold:
    description: 'ì‹¤íŒ¨ ê¸°ì¤€ ì‹¬ê°ë„ (critical, high, medium, low)'
    required: false
    default: 'high'
  github-token:
    description: 'GitHub í† í° (PR ì½”ë©˜íŠ¸, Check Runìš©)'
    required: false
    default: ${{ github.token }}
  config-path:
    description: 'ì»¤ìŠ¤í…€ ì„¤ì • íŒŒì¼ ê²½ë¡œ (.security-action.yml)'
    required: false
  fail-on-findings:
    description: 'ì·¨ì•½ì  ë°œê²¬ ì‹œ ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨ ì²˜ë¦¬'
    required: false
    default: 'true'
  sarif-output:
    description: 'SARIF í¬ë§· ê²°ê³¼ íŒŒì¼ ê²½ë¡œ'
    required: false
    default: 'security-results.sarif'
  upload-sarif:
    description: 'GitHub Security íƒ­ì— SARIF ì§ì ‘ ì—…ë¡œë“œ (ë‚´ì¥ API ì—°ë™)'
    required: false
    default: 'false'
  sarif-category:
    description: 'SARIF ì¹´í…Œê³ ë¦¬(runAutomationDetails.id)'
    required: false
    default: 'security-action'
  fail-on-sarif-upload-error:
    description: 'SARIF ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨ ì²˜ë¦¬'
    required: false
    default: 'false'
  usage-tracking:
    description: 'ì‚¬ìš©ëŸ‰ ì¶”ì (ê¸°ë³¸: false, ì™¸ë¶€ ì „ì†¡ ì—†ìŒ)'
    required: false
    default: 'false'

outputs:
  scan-results:
    description: 'ìŠ¤ìº” ê²°ê³¼ JSON'
  findings-count:
    description: 'ë°œê²¬ëœ ì·¨ì•½ì  ì´ ê°œìˆ˜'
  critical-count:
    description: 'Critical ì‹¬ê°ë„ ì·¨ì•½ì  ê°œìˆ˜'
  high-count:
    description: 'High ì‹¬ê°ë„ ì·¨ì•½ì  ê°œìˆ˜'
  sarif-file:
    description: 'SARIF ê²°ê³¼ íŒŒì¼ ê²½ë¡œ'
  sarif-upload-id:
    description: 'GitHub Code Scanning SARIF ì—…ë¡œë“œ ID'
  sbom-file:
    description: 'SBOM ê²°ê³¼ íŒŒì¼ ê²½ë¡œ'

runs:
  using: 'docker'
  image: 'Dockerfile'
  env:
    # ê¸°ë³¸ ìŠ¤ìºë„ˆ
    INPUT_SECRET_SCAN: ${{ inputs.secret-scan }}
    INPUT_SECRET_SCAN_HISTORY: ${{ inputs.secret-scan-history }}
    INPUT_CODE_SCAN: ${{ inputs.code-scan }}
    INPUT_DEPENDENCY_SCAN: ${{ inputs.dependency-scan }}
    # ì¶”ê°€ ìŠ¤ìºë„ˆ
    INPUT_CONTAINER_SCAN: ${{ inputs.container-scan }}
    INPUT_CONTAINER_IMAGE: ${{ inputs.container-image }}
    INPUT_IAC_SCAN: ${{ inputs.iac-scan }}
    INPUT_IAC_FRAMEWORKS: ${{ inputs.iac-frameworks }}
    # ë„¤ì´í‹°ë¸Œ ì˜ì¡´ì„± ìŠ¤ìº”
    INPUT_NATIVE_AUDIT: ${{ inputs.native-audit }}
    INPUT_NATIVE_AUDIT_TOOLS: ${{ inputs.native-audit-tools }}
    # SBOM
    INPUT_SBOM_GENERATE: ${{ inputs.sbom-generate }}
    INPUT_SBOM_FORMAT: ${{ inputs.sbom-format }}
    INPUT_SBOM_OUTPUT: ${{ inputs.sbom-output }}
    # SonarQube
    INPUT_SONAR_SCAN: ${{ inputs.sonar-scan }}
    SONAR_HOST_URL: ${{ inputs.sonar-host-url }}
    SONAR_TOKEN: ${{ inputs.sonar-token }}
    SONAR_PROJECT_KEY: ${{ inputs.sonar-project-key }}
    # AI ë¦¬ë·°
    INPUT_AI_REVIEW: ${{ inputs.ai-review }}
    INPUT_AI_PROVIDER: ${{ inputs.ai-provider }}
    INPUT_AI_MODEL: ${{ inputs.ai-model }}
    INPUT_OPENAI_API_KEY: ${{ inputs.openai-api-key }}
    INPUT_OPENAI_BASE_URL: ${{ inputs.openai-base-url }}
    OPENAI_BASE_URL: ${{ inputs.openai-base-url }}
    INPUT_ANTHROPIC_API_KEY: ${{ inputs.anthropic-api-key }}
    # ê³µí†µ
    INPUT_CHECK_NAME: ${{ inputs.check-name }}
    INPUT_SKIP_CHECK: ${{ inputs.skip-check }}
    INPUT_SCANNER_CHECKS: ${{ inputs.scanner-checks }}
    INPUT_POST_SUMMARY: ${{ inputs.post-summary }}
    INPUT_SEVERITY_THRESHOLD: ${{ inputs.severity-threshold }}
    INPUT_GITHUB_TOKEN: ${{ inputs.github-token }}
    INPUT_CONFIG_PATH: ${{ inputs.config-path }}
    INPUT_FAIL_ON_FINDINGS: ${{ inputs.fail-on-findings }}
    INPUT_SARIF_OUTPUT: ${{ inputs.sarif-output }}
    INPUT_UPLOAD_SARIF: ${{ inputs.upload-sarif }}
    INPUT_SARIF_CATEGORY: ${{ inputs.sarif-category }}
    INPUT_FAIL_ON_SARIF_UPLOAD_ERROR: ${{ inputs.fail-on-sarif-upload-error }}
    INPUT_USAGE_TRACKING: ${{ inputs.usage-tracking }}
